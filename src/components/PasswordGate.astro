---
// Only show in production
const isProduction = import.meta.env.PROD;
---

{
  isProduction && (
    <div id="password-gate" class="password-gate" style="display: none;">
      <div class="password-gate-content">
        <h1>Enter Password</h1>
        <form id="password-form" class="password-form">
          <input
            type="password"
            id="password-input"
            class="password-input"
            placeholder="Password"
            autocomplete="off"
            required
          />
          <button type="submit" class="password-submit">
            Enter
          </button>
        </form>
        <p id="password-error" class="password-error" style="display: none;">
          Incorrect password. Please try again.
        </p>
      </div>
    </div>
  )
}

<script>
  // Only run in production
  if (import.meta.env.PROD) {
    const PASSWORD = "andamento"; // Change this to your desired password
    const STORAGE_KEY = "portfolio_access_granted";

  const gate = document.getElementById("password-gate");
  const form = document.getElementById("password-form");
  const input = document.getElementById("password-input") as HTMLInputElement | null;
  const error = document.getElementById("password-error");

  // Check if access was already granted
  const accessGranted = sessionStorage.getItem(STORAGE_KEY) === "true";

  if (!accessGranted) {
    // Show the gate
    if (gate) gate.style.display = "flex";
    // Prevent body scroll
    document.body.style.overflow = "hidden";
  }

  if (form && input) {
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const enteredPassword = input.value;

      if (enteredPassword === PASSWORD) {
        // Grant access
        sessionStorage.setItem(STORAGE_KEY, "true");
        if (gate) gate.style.display = "none";
        document.body.style.overflow = "";
        if (error) error.style.display = "none";
      } else {
        // Show error
        if (error) error.style.display = "block";
        input.value = "";
        input.focus();
      }
    });
  }

    // Focus input on load
    if (input && !accessGranted) {
      setTimeout(() => input.focus(), 100);
    }
  }
</script>

<style>
  .password-gate {
    position: fixed;
    inset: 0;
    z-index: 9999;
    background: var(--bg-default);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .password-gate-content {
    text-align: center;
    max-width: 20rem;
    width: 100%;
    padding: var(--spacing-xl);
  }

  .password-gate-content h1 {
    font-family: var(--type-title-1-font-family);
    font-size: var(--font-size-6);
    margin-bottom: var(--spacing-lg);
    color: var(--text-primary);
  }

  .password-form {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
  }

  .password-input {
    font-family: var(--type-body-font-family);
    font-size: var(--type-body-font-size);
    padding: var(--spacing-sm) var(--spacing-md);
    border: 1px solid var(--border-default);
    background: var(--bg-default);
    color: var(--text-primary);
    border-radius: var(--radius-xs);
    outline: none;
    transition: border-color 0.2s;
  }

  .password-input:focus {
    border-color: var(--text-primary);
  }

  .password-submit {
    font-family: var(--type-body-font-family);
    font-size: var(--type-body-font-size);
    font-weight: var(--font-weight-semibold);
    padding: var(--spacing-sm) var(--spacing-md);
    background: var(--text-primary);
    color: var(--bg-default);
    border: none;
    border-radius: var(--radius-xs);
    cursor: pointer;
    transition: opacity 0.2s;
  }

  .password-submit:hover {
    opacity: 0.9;
  }

  .password-error {
    margin-top: var(--spacing-md);
    color: var(--text-secondary);
    font-size: var(--font-size-2);
  }
</style>
